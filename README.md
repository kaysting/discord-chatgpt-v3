# Discord ChatGPT v3
A bot providing a relatively full-featured AI chatbot experience in the comfort of your Discord DMs.

## Features
- Works with all* of OpenAI's `gpt` and `o` series [models](https://platform.openai.com/docs/models)
- Responses are sent in chunks to bypass Discord's character limits
- Chat with the bot in DMs or servers
  - Users are independent of one another and the AI can tell them apart
- Supports file processing for images, audio, and text files
  - Images use Vision
  - Audio uses the configured OpenAI transcription model (ideal for voice messages)
  - Text files are directly embedded into user messages
- Efficient attachment caching to avoid unnecessary network/API usage
- Per-user persistent memory storage allowing the AI to remember things between chats
- Built-in tools for random number and string generation (in addition to memory)
- Extensible tools system allowing additional capabilities to be added to the AI
- Slash commands and Apps menu items for...
  - Ignoring all existing messages or reversing that action
  - Getting an AI response as a raw text (.md) file
  - Viewing the reasoning summary for a response generated by reasoning models
  - Quickly deleting an entire AI response
  - Manually editing/clearing memory about you
  - Managing user access permissions
- Zero-maintenance storage using SQLite

\* all that work with the new [Responses API](https://platform.openai.com/docs/api-reference/responses/create)

## Running the bot
1. [Download and install Node.js](https://nodejs.org/en/download/) if you don't have it
2. Clone (or download and unzip) the repository and `cd` into it with your terminal
3. Run `npm install`
4. Rename `config-example.json` to `config.json`
    * This prevents your config from being overwritten should you update your bot
5. [Create a new Discord application](https://discord.com/developers/applications)
    1. Set its name, description (about me), and picture as you see fit
    2. Copy the Application ID and paste it in the `credentials.discord_application_id` config field
    3. Go to the "Bot" tab and create a new bot if it's not created already
    4. Copy the bot token and paste it in the `credentials.discord_bot_token` config field
    5. Scroll down and make sure "Message content intent" is enabled
6. Set your Discord user ID in the `bot.owner_id` config field. Get this by turning on developer mode in settings and right-clicking on your profile.
7. [Get an OpenAI API key](https://platform.openai.com/account/api-keys) and paste it into the `credentials.openai_api_key` config field
8.  Make any other changes you see fit to the config file, then save it.
9.  Register the bot's commands by running `npm run register`
10. Start the bot with `npm start`
11. After logging in, an invite URL will be shown. Use this to invite the bot to a server.
12. Try it out by DMing or pinging the bot!

## Configuration
- `credentials`: Contains secret keys
  - `openai_api_key`: Your OpenAI API key
  - `discord_bot_token`: Your Discord bot token
  - `discord_application_id`: Your Discord bot's ID
- `bot`: Contains settings pertaining to the Discord bot itself
  - `status`: Controls the bot's profile status
    - `type`: The status type (prefix). Possible values are `Playing`, `Listening`, `Watching`, `Custom` (no prefix).
    - `test`: The status text, following the prefix
- `permissions`: Contains settings controlling user access to the bot
  - `owner_id`: Your Discord user ID. User access management commands can only be used by this user.
  - `public_access`: Whether or not users should be allowed to talk to he bot by default. If `true`, anyone can talk to the bot unless explicitly blocked. If `false`, only people explicitly allowed can talk to the bot.
- `ai`: Contains settings for the AI
  - `chat_model`: The OpenAI model used for conversation
  - `transcription_model`: The OpenAI model used for audio file transcriptions
  - `system_prompt`: Instructions that the AI model should follow when responding. This is appended to the larger internal system prompt. The model is already told its name and that it's a Discord bot, along with other important info.
  - `reasoning`: Settings for reasoning models
    - `enabled`: Set this to `true` if your configured model supports reasoning, otherwise set to `false`
    - `effort`: The amount of effort the model should put into reasoning. Supports values of `minimal`, `low`, `medium`, `high`. Lower values result in faster, cheaper responses.
  - `should_stream`: Whether or not responses from OpenAI should be streamed. Keeping this `true` is generally recommended and makes the real-world response time a few seconds shorter as response chunks are sent as they're generated. Brand new models may require ID verification for your OpenAI organization to use streaming.
- `input`: Contains settings for input types and limits
  - `images`: Contains settings for image inputs
    - `enabled`: Whether or not image attachments should be sent to the AI. Your configured model must support [Vision](https://platform.openai.com/docs/guides/images-vision?api-mode=responses#analyze-images), otherwise set this to `false`.
    - `max_bytes`: The maximum size (in bytes) image attachments must be for them to be included as context
  - `pdfs`: Contains settings for PDF inputs
    - `enabled`: Whether or not PDF attachments should be sent to the AI. Your configured model must support [Vision](https://platform.openai.com/docs/guides/images-vision?api-mode=responses#analyze-images), otherwise set this to `false`.
    - `max_bytes`: The maximum size (in bytes) PDF attachments must be for them to be included as context. Currently OpenAI limits this to 10 MB.
  - `audio`: Contains settings for audio inputs
    - `enabled`: Whether or not audio attachments (including voice messages) should be transcribed and embedded in messages sent to the AI. Transcription will be done using the configured transcription model and stored to avoid running the same file through multiple times.
    - `max_bytes`: The maximum size (in bytes) audio attachments must be for them to be included as context. The transcriptions API generally allows files up to 25 MB. Take care in ensuring the model's context window isn't overflowed by large transcriptions.
  - `text_files`: Contains settings for text file inputs
    - `enabled`: Whether or not the raw data of text file attachments should be embedded in messages sent to the AI. All attachments not fitting any of the criteria above and that are small enough are checked for plain text formatting and embedded into the message.
    - `max_bytes`: The maximum size (in bytes) text file attachments must be for them to be validated and included as context. Take care in ensuring the model's context window isn't overflowed by large text files.
  - `context`: Contains other settings for context
    - `max_messages`: The maximum number of previous messages to send to the AI. Each complete AI response is treated as a single message, even if it's split into multiple Discord messages. Larger values here allow the AI to see further back, but correlate to slower and pricier requests. You may also max out the model's context window. Set this to `1` to only include the immediate prompt message.

## Managing user access permissions
Access to the bot can be limited for certain users, either by:
- Allowing all users to chat by default and manually blocking problem users
- Explicitly only allowing specific users to chat

This default catch-all allow/block behavior is managed by the `config.permissions.allow_public_access` setting, as described above.

From there, you can explicitly allow, block, or reset the access permissions for a specific user by using the `/access` slash commands:

- `/access list`: Get a list of all explicitly allowed and blocked users, along with a description of how the current `allow_public_access` setting affects everyone else.
- `/access allow <user>`: Explicitly allow this user access to the bot.
- `/access block <user>`: Explicitly block this user access to the bot.
- `/access default <user>`: Reset access permissions for this user so they follow the `allow_public_access` setting.

PS: These commands use Discord's slash command system, meaning that you must choose them from the list that appears when typing them and fill out their required parameters to successfully run them.